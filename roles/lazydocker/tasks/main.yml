---
- name: lazydocker
  tags:
    - lazydocker
  block:
    - name: Check latest lazydocker
      ansible.builtin.uri:
        url: https://api.github.com/repos/jesseduffield/lazydocker/releases/latest
        return_content: true
      register: lazydocker

    - name: Create install dir
      ansible.builtin.file:
        path: /opt/lazydocker
        state: directory
        mode: "0755"
      become: true

    # https://github.com/jesseduffield/lazydocker/releases/download/v0.24.1/lazydocker_0.24.1_Linux_x86_64.tar.gz
    - name: Download and unpack latest lazydocker
      ansible.builtin.unarchive:
        src: "https://github.com/jesseduffield/lazydocker/releases/latest/download/lazydocker_{{ lazydocker['json']['tag_name'][1:] }}_Linux_x86_64.tar.gz"
        dest: /opt/lazydocker
        remote_src: true
      become: true

    - name: Symlink binaries
      ansible.builtin.file:
        src: /opt/lazydocker/lazydocker
        dest: /usr/local/bin/lazydocker
        state: link
      become: true


