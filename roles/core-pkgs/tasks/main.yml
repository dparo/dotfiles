---

- name: "Enable the RPM Fusion repository for {{ ansible_distribution }} {{ ansible_distribution_major_version }}"
  ansible.builtin.dnf:
    name:
    - "https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-{{ ansible_distribution_major_version }}.noarch.rpm"
    - "https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-{{ ansible_distribution_major_version }}.noarch.rpm"
    state: latest
  become: True
  when: ansible_distribution == 'Fedora'
  tags:
    - dnf
    - fedora
    - yum.repos.d
    - rpmfusion
    - core-pkgs

- name: Delete unused repositories
  ansible.builtin.file:
    path: "/etc/yum.repos.d/{{ item }}"
    state: absent
  become: True
  when: ansible_distribution == 'Fedora'
  loop:
    - _copr_phracek-PyCharm.repo
    - rpmfusion-nonfree-nvidia-driver.repo
    - rpmfusion-nonfree-steam.repo
  tags:
    - dnf
    - fedora
    - yum.repos.d
    - rpmfusion
    - core-pkgs

- name: Install
  ansible.builtin.dnf:
    name:
      # https://docs.fedoraproject.org/en-US/quick-docs/dnf-system-upgrade/
      - dnf-plugins-core
      - rpmconf
      - symlinks
      - remove-retired-packages
        ###
      - fedora-workstation-repositories # Enable Third party repositories
      - openssl
      - nano
      - git
      - gnupg2
      - direnv
      - ca-certificates
      - openssh
      - polkit
      - sqlite
      - wget
      - curl
      - rclone
      - restic # Modern backup program with support for rclone (Cloud based backups)
      - rsync
      - jq
      - rsync
      - p7zip
      - p7zip-plugins
      - unrar
      - unzip
      - atool # atool is a script for managing file archives of various types (tar,tar+gzip, zip etc)
      - make
      - automake
      - gcc
      - gcc-c++
      - kernel-devel
      - python3-pip
      - bat
      - exa
      - tree
      - fd-find
      - htop
      - btop
      - net-tools
      - lm_sensors
      - ffmpeg
      - speedtest-cli
      - parallel # GNU Parallel is a shell tool for executing jobs in parallel
      - zbar      # QR Code reader
      - qrencode # QR Code encoder
      - oathtool # A command line tool for generating and validating OTPs
    state: present
  become: true
  tags:
    - core-pkgs

- name: Remove unwanted packages
  ansible.builtin.dnf:
    name:
      - libreoffice-core
    state: absent
    autoremove: true
  become: true
  tags:
    - core-pkgs

- name: Install sad (https://github.com/ms-jpq/sad)
  ansible.builtin.unarchive:
    src: "https://github.com/ms-jpq/sad/releases/latest/download/x86_64-unknown-linux-gnu.zip"
    dest: "{{ ansible_user_dir }}/.local/bin"
    remote_src: true
  tags:
    - core-pkgs
    - sad

- name: Symlink config files
  ansible.builtin.file:
    src: "{{ item }}"
    dest: "{{ ansible_user_dir }}/.config/{{ item | basename }}"
    state: link
  loop:
    - "{{ role_path }}/files/direnv"
    - "{{ role_path }}/files/bat"
    - "{{ role_path }}/files/nano"
    - "{{ role_path }}/files/readline"
    - "{{ role_path }}/files/wgetrc"
  tags:
    - core-pkgs
