---

- name: Adding docker repo
  ansible.builtin.shell: |
    dnf config-manager --add-repo https://download.docker.com/linux/fedora/docker-ce.repo
  become: True
  tags:
    - docker

- name: Install
  ansible.builtin.dnf:
    name:
    - docker-ce
    - docker-ce-cli
    - containerd.io
    - docker-compose-plugin
    - podman
    - podman-tui
    state: present
  become: true
  tags:
    - docker
    - podman

- name: Enable service
  ansible.builtin.systemd:
    name: docker
    enabled: false
  become: true
  when: ansible_env.RUNNING_INSIDE_DOCKER is undefined
  tags:
    - docker

- name: "Add the user {{ ansible_env.USER }} to the docker group"
  ansible.builtin.user:
    name: "{{ ansible_env.USER }}"
    append: true
    groups:
      - docker
  become: true
  tags:
    - docker


  # TODO: https://github.com/containers/podman-desktop/releases/download/v1.1.0/podman-desktop-1.1.0.tar.gz
- name: Install podman-desktop
  community.general.flatpak:
    name: io.podman_desktop.PodmanDesktop
    state: present
    remote: flathub
  tags:
    - podman
    - podman-desktop
    - docker

- name: Symlink docker config
  ansible.builtin.file:
    src: "{{ item }}"
    dest: "{{ ansible_user_dir }}/.config/{{ item | basename }}"
    state: link
  loop:
    - "{{ role_path }}/files/config/docker"
  tags:
    - podman
    - podman-desktop
    - docker
