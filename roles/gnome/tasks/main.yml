---
- name: Gnome
  tags:
    - gnome
  block:
    - name: Install extensions
      ansible.builtin.dnf:
        name:
          - gnome-tweaks
          - gnome-extensions-app
          - gnome-shell-extension-appindicator
          - gnome-shell-extension-pop-shell
          - gnome-shell-extension-blur-my-shell
          - gnome-shell-extension-dash-to-dock
        state: present
      become: true

    - name: Setup GNOME settings
      ansible.builtin.shell: |
        gsettings set org.gnome.shell disable-user-extensions false
        gsettings set org.gnome.desktop.peripherals.keyboard repeat-interval 33
        gsettings set org.gnome.desktop.peripherals.keyboard delay 300

        gsettings set org.gnome.desktop.interface cursor-theme 'Adwaita'
        dconf write /org/gnome/desktop/interface/cursor-theme Adwaita

        gsettings set org.gnome.desktop.wm.preferences button-layout ':minimize,maximize,close'
        gsettings set org.gnome.shell.extensions.dash-to-dock disable-overview-on-startup true

        # Move/ Resize windows by holding ALT
        gsettings set org.gnome.desktop.wm.preferences resize-with-right-button true
        gsettings set org.gnome.desktop.wm.preferences mouse-button-modifier '<Alt>'


        # Disable alert sound
        dconf write /org/gnome/desktop/sound/event-sound false
      ignore_errors: true

    - name: Remove unwanted packages
      ansible.builtin.dnf:
        name:
          - orca
          - epiphany-runtime
        state: absent
        autoremove: true
      become: true

    - name: Remove gnome-software (--noautoremove)
      ansible.builtin.dnf:
        name:
          - gnome-software
        state: absent
        autoremove: true
      become: true


    - name: Reinstall flatpak if it was removed
      ansible.builtin.dnf:
        name:
          - flatpak
        state: present
      become: true

