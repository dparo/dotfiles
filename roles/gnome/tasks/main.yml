---
- name: Gnome
  tags:
    - gnome
  block:
    - name: Install extensions
      ansible.builtin.dnf:
        name:
          - gnome-tweaks
          - gnome-extensions-app
          - gnome-shell-extension-appindicator
          # - gnome-shell-extension-pop-shell
          - gnome-shell-extension-blur-my-shell
          - gnome-shell-extension-dash-to-dock
        state: present
      become: true

    - name: Setup GNOME settings
      ansible.builtin.shell: |
        # Keyboard repeat rate
        gsettings set org.gnome.desktop.peripherals.keyboard repeat-interval 33
        gsettings set org.gnome.desktop.peripherals.keyboard delay 300

        # Cursor
        gsettings set org.gnome.desktop.interface cursor-theme 'Adwaita'
        dconf write /org/gnome/desktop/interface/cursor-theme Adwaita

        # Extensions
        gsettings set org.gnome.shell disable-user-extensions false
        gsettings set org.gnome.shell.extensions.dash-to-dock disable-overview-on-startup true

        # Fonts
        gsettings set org.gnome.desktop.interface font-rgba-order 'rgb'
        gsettings set org.gnome.desktop.interface font-hinting 'slight'
        gsettings set org.gnome.desktop.interface font-antialiasing 'grayscale'
        gsettings set org.gnome.desktop.interface font-name "Noto Sans 9"
        gsettings set org.gnome.desktop.interface document-font-name 'Cantarell 11'
        gsettings set org.gnome.desktop.interface monospace-font-name 'JetBrainsMono Nerd Font 10'

        gsettings set org.gnome.desktop.wm.preferences titlebar-font 'Noto Sans Bold 10'
        gsettings set org.gnome.desktop.wm.preferences titlebar-uses-system-font true

        gsettings set org.gnome.TextEditor use-system-font true
        gsettings set org.gnome.TextEditor custom-font 'JetBrainsMono Nerd Font 10'



        # Power settings: Do not suspend/hibernate when on AC power
        gsettings set org.gnome.settings-daemon.plugins.power sleep-inactive-ac-timeout 900
        gsettings set org.gnome.settings-daemon.plugins.power sleep-inactive-ac-type 'nothing'          # nothing | suspend | hibernate
        gsettings set org.gnome.settings-daemon.plugins.power sleep-inactive-battery-timeout 900
        gsettings set org.gnome.settings-daemon.plugins.power sleep-inactive-battery-type 'suspend'

        # Lock screen: Automatic lock screen after 10 minutes, do not show notifications on lock screen
        gsettings set org.gnome.desktop.lockdown disable-lock-screen false
        gsettings set org.gnome.desktop.session idle-delay uint32 600
        gsettings set org.gnome.desktop.notifications show-in-lock-screen false


        # Window controls
        gsettings set org.gnome.desktop.wm.preferences resize-with-right-button true
        gsettings set org.gnome.desktop.wm.preferences mouse-button-modifier '<Alt>'
        gsettings set org.gnome.desktop.wm.preferences button-layout ':minimize,maximize,close'

        # Disable alert sound
        dconf write /org/gnome/desktop/sound/event-sound false


        # Keyboard binds
        gsettings set org.gnome.desktop.wm.keybindings maximize "[ ]"
        gsettings set org.gnome.desktop.wm.keybindings toggle-maximized "[ '<Super>Up' ]"
        gsettings set org.gnome.desktop.wm.keybindings unmaximize "['<Super>Down' ]"
        gsettings set org.gnome.desktop.wm.keybindings begin-resize "[ '<Super>r' ]"
        gsettings set org.gnome.desktop.wm.keybindings begin-resize "[ '<Super>r' ]"
        gsettings set org.gnome.desktop.wm.keybindings activate-window-menu "[ '<Super>space' ]"
        gsettings set org.gnome.desktop.wm.keybindings show-desktop "[ '<Super>d' ]"
        gsettings set org.gnome.desktop.wm.keybindings toggle-fullscreen "[ '<Super>f' ]"
        gsettings set org.gnome.desktop.wm.keybindings close "[ '<Alt>F4', '<Super>q' ]"

      ignore_errors: true

    - name: Remove unwanted packages
      ansible.builtin.dnf:
        name:
          - orca
          - epiphany-runtime
        state: absent
        autoremove: true
      become: true

    - name: Remove gnome-software (--noautoremove)
      ansible.builtin.dnf:
        name:
          - gnome-software
        state: absent
        autoremove: true
      become: true


    - name: Reinstall flatpak if it was removed
      ansible.builtin.dnf:
        name:
          - flatpak
        state: present
      become: true

